<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulsePoint - Login</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #333;
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .back-link:hover {
            color: #0066cc;
        }
        .container {
            max-width: 450px;
            width: 100%;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .hospital-logo {
            text-align: center;
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }
        .plus-sign {
            display: inline-block;
            color: #0066cc;
            font-size: 1.3em;
            margin-right: 2px;
        }
        .form-subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }
        .input-group i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }
        input, select {
            width: 100%;
            padding: 12px 12px 12px 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus {
            border-color: #0066cc;
            outline: none;
        }
        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24'%3E%3Cpath fill='%23aaa' d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 30px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        button {
            background-color: #0066cc;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #0055bb;
        }
        .error {
            color: #c62828;
            margin-top: 15px;
            padding: 10px;
            background-color: #ffebee;
            border-radius: 4px;
            text-align: center;
            display: none;
            border-left: 4px solid #c62828;
        }
        .success {
            color: #2e7d32;
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 4px;
            text-align: center;
            display: none;
            border-left: 4px solid #2e7d32;
        }
        .test-accounts {
            margin-top: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            font-size: 14px;
        }
        .test-accounts h3 {
            margin-top: 0;
            font-size: 16px;
            color: #555;
        }
        .test-accounts p {
            margin: 5px 0;
            color: #666;
        }
        .help-section {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        .help-section p {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
    
    <div class="container">
        <div class="hospital-logo">
            <span class="plus-sign">+</span>PulsePoint
        </div>
        <p class="form-subtitle">Hospital Administration Portal</p>
        
        <div id="errorMessage" class="error"></div>
        <div id="successMessage" class="success"></div>
        
        <form id="loginForm">
            <div class="input-group">
                <i class="fas fa-user-shield"></i>
                <select id="role" name="role" required>
                    <option value="admin">Admin</option>
                    <option value="doctor">Doctor</option>
                    <option value="staff">Staff</option>
                </select>
            </div>
            
            <div class="input-group">
                <i class="fas fa-id-card"></i>
                <input type="text" id="employeeId" name="employeeId" required placeholder="Enter your employee ID">
            </div>
            
            <div class="input-group">
                <i class="fas fa-lock"></i>
                <input type="password" id="password" name="password" required placeholder="Enter your password">
            </div>
            
            <button type="submit">Sign In</button>
        </form>
        
        <div class="test-accounts">
            <h3>Test Accounts:</h3>
            <p><strong>Admin:</strong> ID: 1001, Password: admin123</p>
            <p><strong>Doctor:</strong> ID: 2001, Password: doctor123</p>
            <p><strong>Staff:</strong> ID: 3001, Password: staff123</p>
        </div>
        
        <div class="help-section">
            <p>Need help? Contact IT Support</p>
            <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
            <p><i class="fas fa-envelope"></i> support@pulsepoint.com</p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('loginForm');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            
            // Debug current localStorage
            console.log('Initial localStorage userData:', localStorage.getItem('userData'));
            console.log('Initial localStorage employeeId:', localStorage.getItem('employeeId'));
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Clear previous messages
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                
                // Get form values
                const role = document.getElementById('role').value;
                const employeeId = document.getElementById('employeeId').value;
                const password = document.getElementById('password').value;
                
                // Log values for debugging
                console.log('Login attempt:', { role, employeeId, password });
                
                try {
                    // Show success message to show something is happening
                    successMessage.textContent = "Authenticating...";
                    successMessage.style.display = 'block';
                    
                    // Submit login request
                    const response = await fetch('http://localhost:8080/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            role,
                            employeeId,
                            password
                        })
                    });
                    
                    console.log('Response status:', response.status);
                    
                    if (response.ok) {
                        // First get the raw response text for debugging
                        const responseText = await response.text();
                        console.log('Raw successful response:', responseText);
                        
                        // Parse the response
                        let data;
                        try {
                            data = JSON.parse(responseText);
                            console.log('Parsed login data:', data);
                            
                            if (data.success) {
                                // Store complete user data
                                const userData = {
                                    employeeId: data.employeeId,
                                    fullName: data.fullName,
                                    role: data.role,
                                    loggedInAt: new Date().toISOString(),
                                    success: true // Add success flag explicitly
                                };
                                
                                // Store separately the employeeId for easier access
                                localStorage.setItem('employeeId', data.employeeId);
                                localStorage.setItem('userData', JSON.stringify(userData));
                                
                                console.log('Stored userData:', JSON.stringify(userData));
                                console.log('Stored employeeId:', data.employeeId);
                                
                                // Show success message
                                successMessage.textContent = 'Login successful! Redirecting...';
                                successMessage.style.display = 'block';
                                
                                // Redirect based on role
                                setTimeout(() => {
                                    const redirectPages = {
                                        'admin': 'admin.html',
                                        'doctor': 'doctor_dashboard.html',
                                        'staff': 'staff_dashboard.html'
                                    };
                                    console.log('Redirecting to:', redirectPages[role]);
                                    window.location.href = redirectPages[role];
                                }, 1000);
                            } else {
                                // If success is false but response was OK
                                console.error('Login response indicated failure:', data);
                                errorMessage.textContent = data.message || 'Login failed';
                                errorMessage.style.display = 'block';
                                successMessage.style.display = 'none';
                            }
                        } catch (parseError) {
                            console.error('Error parsing login response:', parseError);
                            errorMessage.textContent = 'Error processing server response';
                            errorMessage.style.display = 'block';
                            successMessage.style.display = 'none';
                        }
                    } else {
                        // If login failed, show error
                        const errorData = await response.text();
                        console.error('Login failed:', errorData);
                        errorMessage.textContent = 'Invalid credentials. Please try again.';
                        errorMessage.style.display = 'block';
                        
                        // Hide the loading message
                        successMessage.style.display = 'none';
                    }
                } catch (error) {
                    console.error('Error during login:', error);
                    errorMessage.textContent = 'Server connection error. Make sure the backend server is running.';
                    errorMessage.style.display = 'block';
                    
                    // Hide the loading message
                    successMessage.style.display = 'none';
                }
            });
            
            // Pre-fill with some testing credentials
            document.getElementById('role').value = 'doctor';
            document.getElementById('employeeId').value = '2001';
            document.getElementById('password').value = 'doctor123';
        });
    </script>
</body>
</html> 